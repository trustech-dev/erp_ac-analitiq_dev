<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="report_expense_sheet_vis">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <div class="row mb-4">
                            <div class="col-12">
                                <h2 class="fw-light text-center text-lg-start ">Expense Report</h2>
                                <hr class="mb-5" />
                            </div>
                        </div>


                        <div class="row mt-2 mb-4">
                            <div class="col-5">
                                <strong>Employee:</strong>
                                <p t-field="o.employee_id.name" />
                            </div>
                            <div class="col-4">
                                <strong>Created on:</strong>
                                <p t-esc="o.create_date" t-options="{'widget': 'date'}" />
                            </div>
                            <div class="col-5">
                                <strong>Protocol:</strong>
                                <p t-field="o.project_id.name" />
                            </div>

                        </div>
                        <div class="row mt-2 mb-4">
                            <div class="col-5">
                                <strong>Description:</strong>
                                <p t-field="o.name" />
                            </div>
                            <div class="col-4">
                                <strong>Patient Payable Amount:</strong>
                                <p t-field="o.patient_payable_amount" />
                            </div>
                            <div class="col-5">
                                <strong>Site:</strong>
                                <p t-field="o.task_id.name" />
                            </div>
                        </div>

                        <table class="table table-md ">
                            <thead>
                                <tr>
                                    <th>Expense Date</th>
                                    <th>Expense Description</th>
                                    <th>Patient</th>
                                    <th>Visit Date</th>
                                    <th>Investigator</th>
                                    <th class="text-right">Price</th>
                                    <th t-if="o.is_multiple_currency" class="text-right">Price in Company Currency</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr t-foreach="o.expense_line_ids" t-as="line">
                                    <td>
                                        <span t-esc="line.date.strftime('%d/%m/%Y')" />
                                    </td>
                                    <td>
                                        <span t-field="line.name" />
                                    </td>
                                    <td style="text-center">
                                        <span t-field="line.patient_id.name" />
                                    </td>
                                    <td style="text-center">
                                        <span t-esc="line.visit_date.strftime('%d/%m/%Y')" />
                                    </td>
                                    <td style="text-center">
                                        <span t-field="line.investigator_id.name" />
                                        <span t-field="line.investigator_id.surname" />
                                    </td>

                                    <td class="text-right">
                                        <span t-field="line.total_amount" t-options='{"widget": "monetary", "display_currency": line.currency_id}' />
                                    </td>
                                    <td t-if="o.is_multiple_currency" class="text-right">
                                        <span t-field="line.total_amount_company" />
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <div class="row justify-content-end">
                            <div class="col-4">
                                <table class="table table-sm">
                                    <tr class="border-black">
                                        <td>
                                            <strong>Total</strong>
                                        </td>
                                        <td class="text-right">
                                            <span t-field="o.total_amount" t-options='{"widget": "monetary", "display_currency": o.currency_id}' />
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row justify-content-start mt-5 mb-0">
                            <div class="col-6">
                                <p>The payments on this form are consistent with the payment approved by the sponsor or
                                    ethics committee per patient visit.</p>
                                <div class="custom-control custom-checkbox">
                                    <div class="col-4">
                                        <input type="checkbox" t-att-id="id_for_label" t-att-checked="true if o.is_approved=='yes' else false" class="form-check-input" />
                                        <label t-att-for="id_for_label" class="form-check-label font-weight-normal">
                                            <span>Yes</span>
                                        </label>
                                    </div>
                                    <div class="col-4">
                                        <input type="checkbox" t-att-id="id_for_label" t-att-checked="true if o.is_approved=='no' else false" class="form-check-input" />
                                        <label t-att-for="id_for_label" class="form-check-label font-weight-normal">
                                            <span>No</span>
                                        </label>
                                    </div>
                                    <div class="col-4">
                                        <input type="checkbox" t-att-id="id_for_label" t-att-checked="true if o.is_approved=='na' else false" class="form-check-input" />
                                        <label t-att-for="id_for_label" class="form-check-label font-weight-normal">
                                            <span>NA</span>
                                        </label>
                                    </div>

                                </div>
                            </div>
                            <t t-if="o.note and o.is_approved=='no'">
                                <div class="col-6">
                                    <p>
                                        <t t-esc="o.note" />
                                    </p>
                                </div>
                            </t>

                        </div>
                        <div class="row justify-content-start mt-5 mb-0">
                            <div class="col-4">
                                <p>Site Coordinator</p>
                                <p>(Name, date and signature)</p>
                            </div>

                            <div class="col-4"></div>

                            <div class="col-4">
                                <p>Accounting Department</p>
                                <p>(Name, date and signature)</p>
                            </div>
                        </div>

                    </div>

                </t>
                <t t-call="web.internal_layout" groups="hr_expense.group_hr_expense_manager">
                    <div class="page">
                        <t t-if="o.get_attachment_status()">
                            <h2 class="fw-light text-center text-lg-start">Attachments</h2>
                            <hr />
                            <style type="text/css">
                                .image-cover {
                                    display: flex;
                                    justify-content: space-around;
                                    flex-wrap: wrap;
                                    margin-top:20px;
                                }
                            </style>
                            <t t-if="o.control_attachment_status_expense_line()" t-foreach="o.expense_line_ids" t-as="line">
                                <div class="image-cover">
                                    <span>
                                        Expense:
                                        <t t-esc="str(line.name)" />
                                    </span>
                                    <hr class="mt-2 mb-2" />
                                    <t t-foreach="line.get_attachments()" t-as="attachment">
                                        <!-- <img t-att-src="image_data_uri(attachment.datas)" class="img-fluid img-thumbnail" style="width: 45%;height: 400px;" /> -->
                                        <!-- <span t-field="attachment.datas"  t-options='{"widget": "image", "style":"width: 45%;height: 400px;"}'/> -->
                                        <img t-if="attachment.datas" t-attf-src="data:image/png;base64,{{ attachment.datas }}" style="width: 45%;height: 400px;" />
                                    </t>
                                </div>
                            </t>
                            <t t-if="not o.control_attachment_status_expense_line()">
                                <div class="image-cover">
                                    <t t-foreach="o.get_attachments()" t-as="attachment">
                                        <!-- <img t-att-src="image_data_uri(attachment.datas)" class="img-fluid img-thumbnail" style="width: 45%;height: 400px;" /> -->
                                        <!-- <span t-field="attachment.datas"  t-options='{"widget": "image", "style":"width: 45%;height: 400px;"}'/> -->
                                        <hr class="mt-2 mb-2" />
                                        <span>
                                        Attachment: 
                                    </span>
                                        <hr class="mt-2 mb-2" />
                                        <img t-if="attachment.datas" t-attf-src="data:image/png;base64,{{ attachment.datas }}" style="width: 55%;height: 405px;" />
                                    </t>
                                </div>
                            </t>
                        </t>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <record id="hr_expense.action_report_hr_expense_sheet" model="ir.actions.report">
        <field name="name">Expenses Report</field>
        <field name="model">hr.expense.sheet</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">mdx_analitq.report_expense_sheet_vis</field>
        <field name="report_file">mdx_analitq.report_expense_sheet_vis</field>
        <field name="print_report_name">'Expenses - %s - %s' % (object.employee_id.name, (object.name).replace('/', ''))
        </field>
        <field name="binding_model_id" ref="hr_expense.model_hr_expense_sheet" />
        <field name="binding_type">report</field>
    </record>

</odoo>